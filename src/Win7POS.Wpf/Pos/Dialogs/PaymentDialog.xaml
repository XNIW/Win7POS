<Window x:Class="Win7POS.Wpf.Pos.Dialogs.PaymentDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Pagamento" Width="1000" Height="580"
        Loaded="OnLoaded" KeyDown="OnKeyDown"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="280"/>
        </Grid.ColumnDefinitions>

        <!-- Col 0: Scontrino (receipt preview) -->
        <Border Grid.Row="0" Grid.Column="0" BorderBrush="#CCC" BorderThickness="1" Margin="0,0,6,0" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="Scontrino" FontWeight="SemiBold" Margin="0,0,0,6"/>
                <TextBox Grid.Row="1" Text="{Binding CartReceiptPreview, Mode=OneWay}"
                         IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                         FontFamily="Consolas" FontSize="11" VerticalContentAlignment="Top"/>
            </Grid>
        </Border>

        <!-- Col 1: Fiscale (placeholder) -->
        <Border Grid.Row="0" Grid.Column="1" BorderBrush="#CCC" BorderThickness="1" Margin="0,0,6,0" Padding="8" Background="#F8F8F8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="Fiscale (PDF / SII)" FontWeight="SemiBold" Margin="0,0,0,6"/>
                <TextBlock Grid.Row="1" Text="Non disponibile" Foreground="Gray" VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Col 2: Rapidi (quick buttons) -->
        <Border Grid.Row="0" Grid.Column="2" BorderBrush="#CCC" BorderThickness="1" Margin="0,0,6,0" Padding="8">
            <StackPanel>
                <TextBlock Text="Rapidi" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <TextBlock Text="Somma" FontSize="11" Foreground="Gray" Margin="0,0,0,4"/>
                <Button Content="+ 200" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding AddQuickAmountCommand}" CommandParameter="20000"/>
                <Button Content="+ 100" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding AddQuickAmountCommand}" CommandParameter="10000"/>
                <Button Content="+ 50" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding AddQuickAmountCommand}" CommandParameter="5000"/>
                <Button Content="+ 20" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding AddQuickAmountCommand}" CommandParameter="2000"/>
                <TextBlock Text="Importo" FontSize="11" Foreground="Gray" Margin="0,12,0,4"/>
                <Button Content="≈ Totale arrot." Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding SetRoundedTotalCommand}"/>
                <Button Content="= Totale esatto" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding SetExactTotalCommand}"/>
                <Button Content="Carta (tutto)" Margin="0,0,0,6" Padding="8,6"
                        Command="{Binding PayAllCardCommand}"/>
            </StackPanel>
        </Border>

        <!-- Col 3: Totale + Contanti/Carta + Pagato/Resto + Tastierino -->
        <Border Grid.Row="0" Grid.Column="3" BorderBrush="#CCC" BorderThickness="1" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" FontWeight="SemiBold" Margin="0,0,0,8">
                    <Run Text="Total pesos "/><Run Text="{Binding TotalDueText}"/>
                </TextBlock>
                <Grid Grid.Row="1" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Contanti:" VerticalAlignment="Center" Width="70"/>
                    <TextBox x:Name="CashBox" Grid.Column="1" Text="{Binding CashReceived, UpdateSourceTrigger=PropertyChanged}"
                             GotFocus="CashBox_GotFocus" LostFocus="CashBox_LostFocus"/>
                </Grid>
                <Grid Grid.Row="2" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Carta:" VerticalAlignment="Center" Width="70"/>
                    <TextBox Grid.Column="1" Text="{Binding CardAmount, UpdateSourceTrigger=PropertyChanged}"
                             GotFocus="CardBox_GotFocus" LostFocus="CardBox_LostFocus"/>
                </Grid>
                <TextBlock Grid.Row="3" Margin="0,0,0,8">
                    <Run Text="Totale pagato "/><Run Text="{Binding TotalPaidText}"/>
                </TextBlock>
                <TextBlock Grid.Row="4" Margin="0,0,0,8" FontWeight="SemiBold"
                           Text="{Binding RestoOrMissingDisplay}"/>
                <!-- Keypad -->
                <UniformGrid Grid.Row="5" Rows="4" Columns="3" Margin="0,8,0,0">
                    <Button Content="7" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="7"/>
                    <Button Content="8" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="8"/>
                    <Button Content="9" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="9"/>
                    <Button Content="4" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="4"/>
                    <Button Content="5" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="5"/>
                    <Button Content="6" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="6"/>
                    <Button Content="1" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="1"/>
                    <Button Content="2" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="2"/>
                    <Button Content="3" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="3"/>
                    <Button Content="0" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="0"/>
                    <Button Content="00" Margin="2" Padding="8" Command="{Binding AppendDigitCommand}" CommandParameter="00"/>
                    <Button Content="⌫" Margin="2" Padding="8" Command="{Binding BackspaceCommand}"/>
                </UniformGrid>
            </Grid>
        </Border>

        <!-- Bottom: Annulla + Conferma pagamento -->
        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Annulla" MinWidth="120" Height="38" Margin="0,0,8,0" Command="{Binding CancelCommand}"/>
            <Button Content="Conferma pagamento" MinWidth="160" Height="38"
                    Command="{Binding ConfirmCommand}"
                    IsEnabled="{Binding IsValid}"/>
        </StackPanel>
    </Grid>
</Window>
